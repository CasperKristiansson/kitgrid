---
import BaseLayout from '../layouts/BaseLayout.astro';
import DocsLayout from '@kitgrid/docs-ui/components/DocsLayout.astro';
import RepoBanner from '@kitgrid/docs-ui/components/RepoBanner.astro';
import BadgeStrip from '@kitgrid/docs-ui/components/BadgeStrip.astro';
import LinkCardGrid from '@kitgrid/docs-ui/components/LinkCardGrid.astro';
import LinkList from '@kitgrid/docs-ui/components/LinkList.astro';
import { docsNav } from '../data/docsNav';
import { project } from '../data/project';

const headings = [
  { depth: 2, slug: 'overview', text: 'Overview' },
  { depth: 2, slug: 'first-pass', text: 'First pass' },
  { depth: 2, slug: 'daily-workflows', text: 'Daily workflows' },
  { depth: 2, slug: 'quality-systems', text: 'Quality systems' },
  { depth: 2, slug: 'reference', text: 'Reference + appendix' },
];

const siteOrigin = Astro.site?.origin ?? 'https://pydantic-fixturegen.kitgrid.dev';
const canonicalUrl = new URL('/', siteOrigin).href;
const searchTarget = `${siteOrigin}?q={search_term_string}`;
const homepageSchema = {
  '@context': 'https://schema.org',
  '@type': 'WebSite',
  name: 'Pydantic Fixturegen Docs',
  url: canonicalUrl,
  description: 'Documentation hub for deterministic Pydantic fixtures, emitters, CLI guides, and diagnostics.',
  potentialAction: {
    '@type': 'SearchAction',
    target: searchTarget,
    'query-input': 'required name=search_term_string',
  },
};
---

<BaseLayout
  title="Pydantic Fixturegen docs"
  description="Deterministic test data factories for Pydantic v2"
  canonical={canonicalUrl}
  structuredData={homepageSchema}
>
  <DocsLayout
    title="Pydantic Fixturegen"
    description="Deterministic fixture generation, emitters, and diagnostics for Pydantic v2."
    navItems={docsNav}
    headings={headings}
    editHref={`https://github.com/${project.repo}/blob/${project.buildRef}/${project.docsPath}/index.md`}
  >
    <section id="overview" class="space-y-4">
      <p class="pill">Deterministic fixtures</p>
      <RepoBanner
        repoUrl="https://github.com/CasperKristiansson/pydantic-fixturegen"
        repoLabel="CasperKristiansson/pydantic-fixturegen"
        badge="GitHub repository"
        ctaLabel="View on GitHub"
      />
      <h2 class="text-3xl font-semibold">Pydantic Fixturegen: deterministic test data, emitters, and diagnostics</h2>
      <p class="text-base-content/80 leading-relaxed">
        Pydantic Fixturegen exists to remove the guesswork from building test data for Pydantic v2 models.
        The CLI discovers models, generates typed fixtures, emits JSON/JSONL snapshots, and records diagnostics so
        audit and CI pipelines stay reproducible. This landing page summarizes the core capabilities and points you
        to the deep dives on discovery internals, command guides, providers, seed policies, and integrations with FastAPI,
        pytest, and Pluggy-based workflows.
      </p>
      <BadgeStrip
        badges={[
          {
            href: 'https://pypi.org/project/pydantic-fixturegen/',
            src: 'https://img.shields.io/pypi/v/pydantic-fixturegen.svg',
            alt: 'PyPI version',
          },
          {
            src: 'https://img.shields.io/pypi/pyversions/pydantic-fixturegen.svg',
            alt: 'Supported Python versions',
          },
          {
            src: 'https://img.shields.io/badge/License-MIT-blue.svg',
            alt: 'License: MIT',
          },
        ]}
      />
      <div class="flex flex-wrap gap-3">
        <a class="btn btn-primary" href="/docs/quickstart">Run the quickstart</a>
        <a class="btn btn-outline" href="/docs/commands/">Explore command guides</a>
        <a class="btn btn-outline" href="/docs/features">See the feature tour</a>
      </div>
      <LinkCardGrid
        tone="muted"
        cards={[
          {
            title: 'Why Fixturegen exists',
            description:
              'Deterministic fixtures for regression tests, data contracts, and CI diffs without hand-rolled scripts.',
          },
          {
            title: 'Who should use it',
            description:
              'Python teams building FastAPI, Django, or microservices that need reproducible JSON, pytest fixtures, schema exports.',
          },
          {
            title: 'What you’ll learn',
            description:
              'Command guides, configuration, cookbook recipes, provider internals, quality guardrails, and CI integrations.',
          },
        ]}
      />
    </section>

    <section id="first-pass" class="space-y-4">
      <h2 class="text-2xl font-semibold">First pass: get oriented</h2>
      <p class="text-base-content/70">
        Jump into the CLI, pick your install strategy, and skim the feature tour before
        automating discovery or emitters. These guides explain how Fixturegen plugs into real-world CI and observability stacks.
      </p>
      <LinkCardGrid
        tone="neutral"
        cards={[
          {
            title: 'Quickstart',
            description: 'Generate JSON + fixtures end to end.',
            href: '/docs/quickstart',
            linkLabel: 'Open guide ↗',
          },
          {
            title: 'Install',
            description: 'pip, Poetry, Hatch, extras, watch mode.',
            href: '/docs/install',
            linkLabel: 'Install instructions ↗',
          },
          {
            title: 'Feature tour',
            description: 'Discovery, emitters, diagnostics overview.',
            href: '/docs/features',
            linkLabel: 'See tour ↗',
          },
        ]}
      />
    </section>

    <section id="daily-workflows" class="space-y-4">
      <h2 class="text-2xl font-semibold">Daily workflows</h2>
      <p class="text-base-content/70">
        Reference the CLI, centralized configuration, and cookbook recipes whenever you
        extend discovery or add emitters. Each link below takes you directly into the workflow-focused docs so new contributors can onboard fast.
      </p>
      <LinkList
        items={[
          { href: '/docs/cli', label: 'CLI reference', description: 'Commands, flags, watch mode.' },
          {
            href: '/docs/configuration',
            label: 'Configuration reference',
            description: 'Precedence, defaults, environment overrides.',
          },
          { href: '/docs/cookbook', label: 'Cookbook', description: 'Repeatable recipes for emitters, providers, seeds.' },
          { href: '/docs/discovery', label: 'Discovery guide', description: 'AST vs safe import, sandboxing, policies.' },
        ]}
      />
    </section>

    <section id="quality-systems" class="space-y-4">
      <h2 class="text-2xl font-semibold">Quality systems</h2>
      <p class="text-base-content/70">
        Use doctor, testing helpers, and seed/preset policies to keep fixtures deterministic
        and auditable.
      </p>
      <LinkCardGrid
        tone="muted"
        cards={[
          {
            title: 'Doctor & diagnostics',
            description: 'Coverage diff, CLI guardrails, snapshots.',
            href: '/docs/doctor',
            linkLabel: 'Open doctor ↗',
          },
          {
            title: 'Testing helpers',
            description: 'pytest snapshot plugin + CLI hooks.',
            href: '/docs/testing',
            linkLabel: 'See helpers ↗',
          },
          {
            title: 'Seeds & presets',
            description: 'Freeze seeds, manage probability policies.',
            href: '/docs/seeds',
            linkLabel: 'Manage seeds ↗',
          },
        ]}
      />
    </section>

    <section id="reference" class="space-y-4">
      <h2 class="text-2xl font-semibold">Reference + appendix</h2>
      <p class="text-base-content/70">
        Keep these close for API signatures, templated paths, and troubleshooting.
      </p>
      <LinkCardGrid
        columns={2}
        tone="subtle"
        cards={[
          {
            title: 'API reference',
            description: '`generate_json`, `generate_fixtures`, schema emitters.',
            href: '/docs/api',
            linkLabel: 'View API ↗',
          },
          {
            title: 'Output paths + security',
            description: 'Templated destinations, sandbox policies, troubleshooting.',
            href: '/docs/output-paths',
            linkLabel: 'Output paths ↗',
          },
          {
            title: 'Security & troubleshooting',
            description: 'Runbooks for sandbox policies, doctor failures, CLI diagnostics.',
            href: '/docs/security',
            linkLabel: 'Security guides ↗',
          },
        ]}
      />
    </section>
  </DocsLayout>
</BaseLayout>
