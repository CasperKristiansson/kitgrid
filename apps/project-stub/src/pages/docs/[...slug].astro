---
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import { DocsLayout, mdxComponents } from '@kitgrid/docs-ui';
import { docsNav } from '../../data/docsNav';

export async function getStaticPaths() {
  const entries = await getCollection('docs');
  return entries.map((entry: CollectionEntry<'docs'>) => ({
    params: { slug: entry.slug },
  }));
}

const entries = await getCollection('docs');
if (!entries.length) {
  throw new Error('Add entries under src/content/docs');
}

type DocsEntry = CollectionEntry<'docs'>;

const routeParams = Astro.params as { slug?: string | string[] };
const slugParam = routeParams.slug;
const slug = Array.isArray(slugParam) ? slugParam.join('/') : (slugParam ?? '');
const entry = entries.find((doc: DocsEntry) => doc.slug === slug) ?? entries[0];
const { Content, headings } = await entry.render();
const editHref = entry.data.editUrl;
const versionLabel = entry.data.versionLabel ?? 'latest';
---

<BaseLayout
  title={`${entry.data.title} â€” Docs stub`}
  description={entry.data.description}
>
  <DocsLayout
    title={entry.data.title}
    description={entry.data.description}
    navItems={docsNav}
    headings={headings}
    editHref={editHref}
    versionLabel={versionLabel}
  >
    <Content components={mdxComponents} />
  </DocsLayout>
</BaseLayout>
